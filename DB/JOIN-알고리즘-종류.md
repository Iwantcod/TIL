# JOIN 알고리즘의 종류

- [용어](#용어)<br>
- [MySQL JOIN](#mysql의-대표적인-join-알고리즘-세가지)<br>
  - [NL JOIN](#nasted-looped-join)
  - [Hash JOIN](#hash-join)
  - [Sort-Merge JOIN](#sort-merge-join)
- [드라이빙/드리븐 테이블 선정 기준](#드라이빙드리븐-테이블-선정-기준)
  - [Block NL JOIN](#block-nested-loop-join)

## 용어
Driving Table: 조인에서 먼저 읽히는 테이블(기준 테이블)<br>
Driven Table: 드라이빙 테이블의 각 행에 대해 나중에 접근되는 테이블(조인 대상)


## MySQL의 대표적인 JOIN 알고리즘 세가지

### Nasted Looped JOIN
중첩 반복문 조인<br>

<img width="680" height="355" alt="Image" src="https://github.com/user-attachments/assets/936881bc-7bdb-491d-9a55-fd60eaa28c72" />

*출처: 코딩팩토리*

1. 드라이빙 테이블의 각 행을 하나씩 읽는다.
2. 각 행마다 드리븐 테이블에서 조인 조건에 해당하는 행을 찾는다.
3. 조건에 맞는 행을 결과로 반환한다.

특징: 기본 조인 방식이다. 단순하고 직관적인 알고리즘을 이용한다.<br>
장점: 구현이 단순하며 드라이빙 테이블이 작을수록 효율이 좋고, 자원 사용률이 적다.<br>
단점: 드리븐 테이블의 조인 조건 컬럼에 인덱스가 설정되어 있지 않다면 성능이 크게 저하될 수 있다.

### Hash JOIN
해시 테이블을 이용한 조인<br>

<img width="698" height="472" alt="Image" src="https://github.com/user-attachments/assets/42fa6725-8f04-4af5-9687-077edf78ab84" />

*출처: 2WEEKS - 티스토리*

1. 두 테이블 중 크기가 더 작은 테이블의 조인 조건 컬럼으로 해시 테이블을 생성한다.
2. 나머지 테이블의 각 행에 대해 해시 테이블에서 일치하는 값을 찾는다.

특징: 해시 값 비교를 통한 조인이므로 '동등 연산'만 수행할 수 있다.<br>
장점: 조인 컬럼에 적절한 인덱스가 존재하지 않거나, 대용량 테이블을 조인하는 경우 유용하게 사용된다.<br>
단점: 해시 테이블 생성 등에 대한 메모리가 추가적으로 필요하다. 이 해시 테이블이 과도하게 커질 경우 임시 테이블이 생성될 수 있어 성능 저하가 발생할 수 있다.

### Sort-Merge JOIN

<img width="1702" height="1131" alt="Image" src="https://github.com/user-attachments/assets/51c51f2e-2929-49d4-98ba-d52a4a365ad8" />

*출처: 코딩팩토리*

두 테이블을 조인 컬럼을 기준으로 정렬한 다음, 1번씩만 조회하여 조인을 수행

1. 두 테이블을 조인 컬럼을 기준으로 정렬
2. 정렬된 두 테이블을 앞에서부터 한번씩만 순회하며 조건에 맞는 행 탐색

특징: 정렬 과정이 필요하므로, 이미 정렬되어 있거나 인덱스가 있는 경우 효율적이다.<br>
장점: 조인 컬럼에 인덱스가 없고 대용량 테이블을 조인하는 경우 유용하다.<br>
단점: 조인 컬럼에 인덱스가 없고 정렬되어 있지도 않은 경우, 정렬에 필요한 비용이 커 자원을 많이 소모하게 된다.

## 드라이빙/드리븐 테이블 선정 기준

조인 연산 전 옵티마이저가 드라이빙/드리븐 테이블을 선정한 뒤 연산을 수행한다. 어떠한 기준으로 선정하는지 알아보자.

1. 조인 컬럼에 인덱스가 존재하는 테이블이 드리븐 테이블로 선호된다.
    - 이 경우 드라이빙 테이블의 튜플 수 만큼만 '인덱스 탐색'을 하면 된다.
2. 반환 행의 수가 적은 테이블이 드라이빙 테이블로 선호된다.
     - 탐색 시도 횟수가 줄어들기 때문에, 테이블의 크기 또한 고려한다.
3. 조건이 비슷하다면 FROM 절의 순서대로 드라이빙/드리븐 테이블이 선택된다.

### Block Nested Loop JOIN
둘 다 인덱스가 없는 경우 일반적인 Nested Loop JOIN 대신 Block Nested Loop Join이 수행된다. 이 조인은 드라이빙 테이블을 조인 버퍼에 적재하고, 드리븐 테이블을 한번 순회하며 버퍼와 비교하는 방식이다.<br>
조인 버퍼 할당을 위한 메모리 부족 시 성능이 감소한다는 한계점이 있지만, 인덱스가 없는 경우에서 일반 Nested Loop JOIN보다 효율이 높다.

*조인 버퍼란? 조인 연산에서 인덱스를 활용할 수 없는 경우 드라이빙 테이블의 여러 행을 메모리에 저장해두고, 드리븐 테이블과의 비교에 활용되는 메모리 공간*