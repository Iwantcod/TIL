# 인덱스

- [개념](#개념)
  - [B-Tree](#b-tree)
- [MySQL 인덱스](#mysql-인덱스)
  - [클러스터 인덱스](#클러스터-인덱스)
  - [보조 인덱스](#보조-인덱스)
  - [커버링 인덱스](#커버링-인덱스)

## 개념
인덱스란 데이터를 쉽고 빠르게 찾기 위해 만들어진 데이터 구조이다. 마치 책의 목차를 참고하여 원하는 내용을 빠르게 찾아내는 것처럼, 원하는 데이터를 빠르게 찾아낸다.<br>
데이터베이스에서 인덱스는 원하는 데이터를 빨리 찾기 위해 튜플의 키 값에 대한 물리적 위치를 기록해 둔 자료구조이다. 일반적인 RDBMS의 인덱스는 대부분 B-Tree로 되어있다.

### B-Tree
B-Tree는 루트 노드, 내부 노드(Internal node), 리프 노드로 구성되며, 리프 노드가 모두 **같은 레벨**에 존재하는 트리이다.
- 각 노드는 키 값과 포인터를 가진다.
  - 키 값은 오름차순으로 정렬된다.
- 키 값 좌우에 위치한 포인터는 각각 키 값보다 작은 값과 큰 값을 가진 다음 노드를 가리킨다.
  - 키 값 비교를 통해 다음 단계의 노드를 빠르게 찾을 수 있다.
- 모든 조회는 루트 노드로부터 시작된다.
- 키 값 추가/삭제 시 동적으로 노드를 분할하거나 통합하여 균형을 유지한다.

B-Tree의 리프 노드에는 해당 데이터의 저장 위치에 대응하는 rowID(RID, 테이블의 행에 대한 논리적 위치)가 있어, 찾고자 하는 행을 바로 찾을 수 있다.<br>
조회 성능이 향상되는 만큼 데이터의 수정이나 추가가 잦을 경우 B-Tree의 모양을 유지하기 위한 과정이 빈번해져 부하가 발생한다는 문제가 있다.

## MySQL 인덱스
MySQL의 인덱스는 클러스터 인덱스와 보조 인덱스로 나뉘며 모두 B-Tree를 기반으로 한다.

<img width="2220" height="1200" alt="Image" src="https://github.com/user-attachments/assets/120d8244-554d-4265-9596-583ae59c804b" />

*출처: https://tecoble.techcourse.co.kr/post/2021-10-12-covering-index/*

### 클러스터 인덱스
클러스터 인덱스는 인덱스의 리프 노드들이 정렬된 상태로 저장된 테이블 그 자체이다. 테이블 당 하나만 생성할 수 있으며, 키 값에 따라 정렬된 형태로 저장되어 있어 범위 검색에서도 손쉽게 검색할 수 있다.<br>
기본적으로 PK를 기준으로 생성된다.

### 보조 인덱스
보조 인덱스는 클러스터 인덱스를 제외한 모든 인덱스이다. 클러스터 인덱스와 다르게 리프 노드에 컬럼의 값과 'PK 값(클러스터 인덱스의 기준 컬럼 값)'을 기본적으로 저장한다.<br>
또한 인덱스의 기준 컬럼 내용만을 기준으로 정렬이 수행되기에 범위 탐색에도 사용될 수 있다.<br>
보조 인덱스를 통해 조회할 때에는 '보조 인덱스 - PK 획득 - 클러스터 인덱스 조회'의 3단계를 거친다.

### 커버링 인덱스
커버링 인덱스는 인덱스의 종류가 아닌, 실제 데이터에 접근하지 않고 **인덱스에 존재하는 값만으로 쿼리가 완성되는 상태**를 의미한다.<br>
보조 인덱스는 기본적으로 PK값만 가지고 있으나, 필요에 의해 부가적인 컬럼값을 추가하여 인덱스만으로 쿼리 결과를 만들어낼 수 있다.<br>
이 경우 클러스터 인덱스를 2차적으로 조회할 필요가 없으므로, 조회 성능이 향상된다. 그러나, 보조 인덱스에 새롭게 추가된 컬럼의 값이 수정/삭제되는 경우 쓰기 작업이 추가적으로 더 발생하게 되므로 쓰기 성능은 상대적으로 더 낮아진다.